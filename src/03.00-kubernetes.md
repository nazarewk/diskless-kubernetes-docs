
# System Kubernetes

[`Kubernetes`](https://kubernetes.io/) jest obecnie
najpopularniejszym systemem zarządzania kontenerami, a przez to tematem 
przewodnim tego dokumentu.  Został stworzony przez `Google` na bazie ich
wewnętrznego systemu Borg, a następnie udostępniony na zasadach otwartego
oprogramowania.

W porównaniu do innych narzędzi `k8s` oferuje najlepszy kompromis między
oferowanymi możliwościami, a kosztami administracyjnymi.

Zarządzanie klastrem zdefiniowane jest jako zbiór czynności 
i procesów polegających na przygotowaniu klastra do użytku oraz definiowanie
aplikacji realizującymi usługi na poziomie klastra, takimi jak:

- tworzenie klastra,
- dodawanie i usuwanie fizycznych węzłów,
- integracja z sieciowym systemem plikowym,
- integracja z zewnętrznymi systemami zarządzania kontami użytkowników,
- nadawanie uprawnień użytkownikom i procesom,
- centralny system zbierania dzienników aplikacji (ang. _centrallized logging system_),
- centralny system monitorujący obciążenie węzłów,

Korzystanie z klastra zdefiniowane jest jako uruchamianie dowolnych aplikacji
na skonfigurowanym klastrze.

## Wyjaśnienie pojęcia stanu w klastrze Kubernetes

Ważną kwestią jest zrozumienie pojęcia stanu w klastrze `k8s`.
Jest to konfiguracja do której klaster dąży, a nie w której znajduje się w
danej chwili.

Zwykle stan docelowy i aktywny szybko się ze sobą zbiegają, ale nie jest to
regułą. Najczęstszymi scenariuszami jest brak zasobów do uruchomienia aplikacji
w klastrze lub utrata węzła roboczego.

W pierwszym przypadku stan klastra może wskazywać na istnienie 5 instancji
aplikacji, ale pamięci RAM wystarcza na uruchomienie tylko 3. Więc bez zmiany
infrastruktury brakujące 2 instancje nigdy nie zostaną uruchomione. W momencie
dołączenia kolejnego węzła klastra może się okazać, że posiadamy już oczekiwane
zasoby i aplikacja zostanie uruchomiona w pełni.

W drugim przypadku załóżmy, że aplikacja jest uruchomiona w 9 kopiach na 4
węzłach, po 2 kopię na pierwszych trzech węzłach i 3 kopie na ostatnim.
W momencie wyłączenia ostatniego węzła aplikacja będzie miała uruchomione
tylko 6 z 9 docelowych instancji. Zanim moduł kontrolujący klaster zauważy braki
aktywny stan 6 nie będzie się zgadzał z docelowym 9. W ciągu kilku do 
kilkudziesięciu sekund kontroler uruchomi brakujące 3 instancje i uzyskamy 
docelowy stan klastra: po 3 kopie aplikacji na 3 węzłach.
