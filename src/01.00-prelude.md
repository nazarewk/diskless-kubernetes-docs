# Wstęp

W pracy możemy wyróżnić dwa stosunkowo niezależne od siebie pojęcia:
zarządzanie kontenerami w klastrze `Kubernetes` (zamiennie nazywanym `k8s`) oraz
jego bazowaniu na maszynach bezdyskowych. W tym rozdziale zarysowany jest
problem izolacji w kontekście systemów komputerowy: co rozwiązuje, w jaki sposób
się zmieniał, jaki jest stan obecny.
Następnie przedstawione są motywacje kierujące wyborem `k8s` z pośród
dostępnych narzędzi zarządzania kontenerami oraz wyborem systemów bezdyskowych
jako jego fundamentu.

## Zarys historyczny izolacji zasobów komputerowych

Historia wirtualizacji i przydzielania zasobów sięga pierwszych systemów
komputerowych.
Podstawową przeszkodą w korzystaniu z komputerów była ich wysoka
cena; bogate instytucje odpłatnie wynajmowały swoje systemy innym instytucjom.
Umożliwiając dostęp tylko jednemu użytkownikowi jednocześnie maszyny przez
większość czasu nie pracowały. Wraz ze wzrostem
liczby użytkowników zwiększało się wysycenie zasobów.
Kolejną przeszkodą był brak ograniczeń dostępowych dla poszczególnych
użytkowników: każdy świadomie lub nie mógł uszkodzić konta innych użytkowników.
W ten sposób zrodził się pomysł `chroot`, czyli izolacji użytkowników na
poziomie systemu plików.

Na tym etapie wraz z rozwojem technologii zwiększała się różnorodność sprzętowa
i systemowa. W związku z pierwszą rozwijały się systemy operacyjne oferowały
abstrakcje dostępu do sprzętu oraz powstawały narzędzia emulujące inny sprzęt
(tzw. wirtualizacja sprzętowa). Różnorodność systemowa była natomiast
abstrahowana przez aplikacyjne wirtualne maszyny jak na przykład `Java`, które
umożliwiały jednorodny dostęp do zasobów systemowych.

W centrach danych zyskała popularność wirtualizacja sprzętowa pozwalająca
na uruchomienie na jednej fizycznej maszynie wielu niezależnych od
siebie maszyn wirtualnych, na których z kolei działają dowolne systemy
operacyjne. W toku rozwoju technologii w latach 2000 pojawił się trend
rozpraszania systemów i dążenia do uruchamiania jak najmniejszej funkcjonalnej
części systemu komputerowego na pojedynczej maszynie wirtualnej.
Przede wszystkim takie podejście zwiększa bezpieczeństwo: po uzyskaniu
dostępu do jednego z serwerów włamywacz nadal nie ma dostępu do innych części
systemu.
Przeciętna maszyna fizyczna nie jest w stanie uruchomić więcej niż kilku do
kilkunastu maszyn wirtualnych. W związku z tym utrzymywanie całej maszyny
wirtualnej i systemu operacyjnego w celu uruchamiania często pojedynczego
procesu aplikacyjnego stało się kosztowne i nieekonomiczne.

Na przełomie dekady zaczęły pojawiać się narzędzia pozwalające na uruchamianie
wielu w pełni odizolowanych procesów współdzielących jedynie jądro systemu
operacyjnego.
Znacznie zmniejszyło to narzut zasobów wymagany do uruchamiania kolejnych
aplikacji-procesów i umożliwiło uruchamianie setek, a nawet tysięcy aplikacji
na jednej fizycznej maszynie.
Metodologia zyskała miano konteneryzacji. Jest z powodzeniem wykorzystywana
w systemach produkcyjnych na całym świecie.

Technologia konteneryzacji jest młoda, a konkurencja duża. Z jednej strony trwa
wyścig o stworzenie najlepszego rozwiązania. Z drugiej strony nikt nie może
pozwolić sobie na niekompatybilność implementacji i równie aktywnie rozwijane są 
otwarte standardy konteneryzacji w ramach [`Open Container Initiative`](https://www.opencontainers.org/about).
Obecnie najpopularniejszą implementacją kontenerów jest `Docker`.

Aspektem równie ważnym jak same kontenery jest kwestia zarządzania nimi.
O ile kilkoma serwerami z kilkudziesięcioma kontenerami może zarządzać człowiek,
o tyle do zarządzania tysiącami kontenerów wymagany jest znacznie
zautomatyzowany i wyspecjalizowany system.
Obecnie przodującym rozwiązaniem tego problemu jest `Kubernetes` i na nim
skupia się ten dokument.

## Charakterystyka systemów bezdyskowych

Historycznie funkcję serwerów w centrach danych pełniły w pełni wyposażone 
stacje robocze składające się między innymi z:

- pamięci RAM,
- procesorów,
- kart sieciowych,
- dysków twardych.

Na takich maszynach systemy operacyjne są indywidualnie instalowane na lokalnym
dysku twardym w celu ograniczenia komunikacji sieciowej, która była znacznie od
nich wolniejsza. W takiej architekturze każdy serwer miał własną konfigurację i
nie było centralnego miejsca do zarządzania nimi.

W dzisiejszych czasach rozwój sieci komputerowych i spadek cen pamięci RAM
pozwolił na konfigurację maszyn nie posiadających dysku twardego.
Bezdyskowe maszyny przy starcie pytają centralny serwer o swoją konfigurację
(np. protokołem `PXE`), a następnie umieszczają kompletny system operacyjny
w pamięci RAM.

W momencie wyłączenia maszyny cały stan jest tracony, a przy ponownym rozruchu
maszyna konfigurowana jest od nowa.
W celu trwałego przechowywania danych systemy bezdyskowe łączą się do
zewnętrznego serwera plików (np. `NFS` lub `CephFS`) i na nim przechowują dane.

Rozwiązanie pozwala to na jednorazową konfigurację bazowego systemu operacyjnego
i uzyskanie konfiguracji na dowolnej ilości maszyn bez ingerencji człowieka.
W efekcie koszt utrzymania centrum danych przenosi się z konfiguracji
indywidualnych maszyn na konfigurację pojedynczych usług działających na
dowolnej liczbie maszyn.

W związku z powyższym system bezdyskowy jest bardzo dobrym kandydatem do
konfiguracji klastra Kubernetes.


## Lista alternatyw Kubernetes

`Kubernetes` oferuje duże możliwości w stosunku do progu wejścia w system, ale
istnieją również inne rozwiązania, o których warto wspomnieć.

##### Fleet
jest nakładką na `systemd` realizującą rozproszony system inicjalizacji
systemów operacyjnych `CoreOS`. Kontenery są uruchamiane i zarządzane przez
`systemd`, a stan przechowywany jest w `etcd`.

Aktualnie projekt kończy swój żywot na rzecz `k8s` i w dniu 1 lutego 2018,
został wycofany z domyślnej dystrybucji `CoreOS`. Nadal będzie dostępny w
rejestrze pakietów `CoreOS`.

##### Docker Swarm
jest rozwiązaniem zarządzania kontenerami zintegrowanym z systemem `Docker`.
Główną zaletą jest niski próg wejścia i prostota, a wadą są małe
możliwości w stosunku do innych rozwiązań.

##### Nomad

jest narzędziem do zarządzania siecią komputerową, które również oferuje zarządzanie
kontenerami.

Przy jego tworzeniu twórcy kierują się filozofią `Unix`. W związku z tym `Nomad`
jest prosty w obsłudze, wyspecjalizowany i rozszerzalny. Zwykle działa w
tandemie z innymi produktami firmy "HashiCorp" jak `Consul` i `Vault`.

##### Mesos
jest najbardziej zaawansowanym i najefektywniej skalującym się rozwiązaniem
zarządzania kontenerami.
Jest również najbardziej skomplikowanym i trudnym w zarządzaniu rozwiązaniem.
W związku z tym znajduje swoje zastosowanie tylko w największych sieciach
komputerowych o zasięgu globalnym.
